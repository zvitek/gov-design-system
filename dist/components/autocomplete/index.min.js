/*! Gov v0.1.0 | MIT License | github.com/gov/gov */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Autocomplete={})}(this,function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(t,e){return e.split(".").reduce(function(t,e){return t?t[e]:null},t)}var o={mixins:[{props:{validationMessage:{type:[String,Array],required:!1,default:null}},mounted:function(){var t=this;this.$nextTick(function(){return t.prepareValidity()})},watch:{validationMessage:function(){this.prepareValidity()}},computed:{parentField:function(){for(var t=this.$parent,e=0;e<3;e++)t&&!t.$data._isField&&(t=t.$parent);return t},childField:function(){var t=this.$children.filter(function(t){return t.$data._isField});return t.length?t[0]:null}},methods:{prepareValidity:function(){var t=this.validationMessage;Array.isArray(t)&&t.length||"string"==typeof t?this.setValidity(t):this.setValidity(null)},setValidity:function(t){var e=this;this.$nextTick(function(){var n=e.childField||e.parentField;n&&(n.errorMessage=t)})}}}],props:{autocomplete:{type:String,required:!1,default:void 0},maxlength:{type:[Number,String],required:!1,default:void 0},customUniqueId:{type:[String,Number],required:!1,default:null}},data:function(){return{uniqueId:null,isFocused:!1}},mounted:function(){this.uniqueId=this.customUniqueId||"input_"+function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length,o=0;o<t;o++)e+=n.charAt(Math.floor(Math.random()*i));return e}()},watch:{uniqueId:function(){this.swtUniqueId()}},computed:{parentField:function(){for(var t=this.$parent,e=0;e<3;e++)t&&!t.$data._isField&&(t=t.$parent);return t}},methods:{focus:function(){var t=this.getElement();void 0!==t&&this.$nextTick(function(){t&&t.focus()})},onBlur:function(t){this.isFocused=!1,this.$emit("blur",t)},onFocus:function(t){this.isFocused=!0,this.$emit("focus",t)},getElement:function(){for(var t,e=this.$refs[this.$data._elementRef];(t=e)&&t._isVue;)e=e.$refs[e.$data._elementRef];return e},setNotEmpty:function(t){var e=this;this.$nextTick(function(){e.parentField&&(e.parentField.notEmpty=t)})},swtUniqueId:function(){var t=this;this.$nextTick(function(){t.parentField&&(t.parentField.uniqueId=t.uniqueId)})}}},r={mixins:[o],inheritAttrs:!1,props:{value:[Number,String],type:{type:String,default:"text"},lazy:{type:Boolean,default:!1},whisperer:{type:Boolean,default:!1},customClass:{type:String,default:""}},data:function(){return{newValue:this.value,enforceEmptyValue:!1,_elementRef:"input"}},computed:{computedValue:{get:function(){return this.newValue},set:function(t){this.newValue=t,this.$emit("input",t)}},valueLength:function(){return"string"==typeof this.computedValue?this.computedValue.length:"number"==typeof this.computedValue?this.computedValue.toString().length:0}},watch:{value:function(t){this.newValue=t,this.calculateNotEmpty()}},methods:{onInput:function(t){if(!this.lazy){var e=t.target.value;this.updateValue(e)}},onChange:function(t){if(this.lazy){var e=t.target.value;this.updateValue(e)}},newOnBlur:function(t){this.onBlur(t),this.calculateNotEmpty()},newOnFocus:function(t){this.onFocus(t),this.calculateNotEmpty()},updateValue:function(t){this.computedValue=t},calculateNotEmpty:function(){this.setNotEmpty(this.isFocused||this.valueLength||this.enforceEmptyValue)}},mounted:function(){this.calculateNotEmpty()}},s="on";var u=function(t,e,n,i,o,r,s,u,l,a){"boolean"!=typeof s&&(l=u,u=s,s=!1);var c,d="function"==typeof n?n.options:n;if(t&&t.render&&(d.render=t.render,d.staticRenderFns=t.staticRenderFns,d._compiled=!0,o&&(d.functional=!0)),i&&(d._scopeId=i),r?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,l(t)),t&&t._registeredComponents&&t._registeredComponents.add(r)},d._ssrRegister=c):e&&(c=s?function(){e.call(this,a(this.$root.$options.shadowRoot))}:function(t){e.call(this,u(t))}),c)if(d.functional){var p=d.render;d.render=function(t,e){return c.call(e),p(t,e)}}else{var h=d.beforeCreate;d.beforeCreate=h?[].concat(h,c):[c]}return n};const l=u({render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("input",t._b({ref:"input",staticClass:"gov-form-control__input",class:[t.customClass],attrs:{type:t.type,autocomplete:t.newAutocomplete,maxlength:t.maxlength,id:t.uniqueId},domProps:{value:t.computedValue},on:{input:t.onInput,change:t.onChange,blur:t.newOnBlur,focus:t.newOnFocus}},"input",t.$attrs,!1))},staticRenderFns:[]},void 0,{name:"GovInput",mixins:[r,o],computed:{newAutocomplete:function(){return this.autocomplete||s}},watch:{type:function(){this.resolveNativeTypes()}},methods:{resolveNativeTypes:function(){-1!==["date","time"].indexOf(this.type)&&(this.enforceEmptyValue=!0,this.calculateNotEmpty())}},mounted:function(){var t=this;this.$nextTick(function(){t.whisperer&&t.$refs.input.addEventListener("blur",function(){t.isFocused=!1,t.calculateNotEmpty()})}),this.resolveNativeTypes()}},void 0,!1,void 0,!1,void 0,void 0,void 0);var a,c,d;const p=u({render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"gov-autocomplete",attrs:{role:"combobox","aria-haspopup":"listbox"}},[n("gov-input",t._b({ref:"input",attrs:{maxlength:t.maxlength,autocomplete:t.newAutocomplete,"aria-autocomplete":t.ariaAutocomplete,"custom-unique-id":t.customUniqueId,whisperer:!0},on:{input:t.onInput,focus:t.focused,blur:t.onBlur},nativeOn:{keydown:[function(e){return t.keydown(e)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:(e.preventDefault(),t.keyArrows("up"))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:(e.preventDefault(),t.keyArrows("down"))}]},model:{value:t.newValue,callback:function(e){t.newValue=e},expression:"newValue"}},"gov-input",t.$attrs,!1)),n("div",{ref:"dropdown",style:t.style},[n("ul",{directives:[{name:"show",rawName:"v-show",value:t.isActive&&(!t.isEmpty||t.hasEmptySlot),expression:"isActive && (!isEmpty || hasEmptySlot)"}],staticClass:"gov-autocomplete__results"},[t._l(t.computedData,function(e,i){return[e.group?n("li",{key:i+"group",staticClass:"gov-autocomplete__result",attrs:{role:"option"}},[t.hasGroupSlot?t._t("group",null,{group:e.group,index:i}):n("strong",[t._v(" "+t._s(e.group)+" ")])],2):t._e(),t._l(e.items,function(e,o){return n("li",{key:i+":"+o,staticClass:"gov-autocomplete__result",class:{selected:e===t.hovered},attrs:{role:"option"},on:{click:function(n){return n.stopPropagation(),t.setSelected(e,!t.keepOpen,n)}}},[t.hasDefaultSlot?t._t("default",null,{option:e,index:o}):[t._v(" "+t._s(t.getValue(e,!0))+" ")]],2)})]}),t.isEmpty&&t.hasEmptySlot?n("li",{staticClass:"gov-autocomplete__empty"},[t._t("empty")],2):t._e()],2)])],1)},staticRenderFns:[]},void 0,{name:"GovAutocomplete",components:(a={},c=l.name,d=l,c in a?Object.defineProperty(a,c,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[c]=d,a),mixins:[o],inheritAttrs:!1,props:{value:[Number,String],data:{type:Array,default:function(){return[]}},field:{type:String,default:"value"},keepFirst:Boolean,clearOnSelect:Boolean,openOnFocus:Boolean,customFormatter:Function,checkInfiniteScroll:Boolean,keepOpen:Boolean,selectOnClickOutside:Boolean,clearable:Boolean,maxHeight:[String,Number],groupField:String,groupOptions:String,confirmKeys:{type:Array,default:function(){return["Tab","Enter"]}},customUniqueId:{type:[String,Number],required:!1,default:null}},data:function(){return{selected:null,hovered:null,isActive:!1,newValue:this.value,newAutocomplete:this.autocomplete||"off",ariaAutocomplete:this.keepFirst?"both":"list",hasFocus:!1,style:{},_isAutocomplete:!0,_elementRef:"input"}},computed:{computedData:function(){var t=this;if(this.groupField){if(this.groupOptions){var e=[];return this.data.forEach(function(n){var o=i(n,t.groupField),r=i(n,t.groupOptions);e.push({group:o,items:r})}),e}var n={};this.data.forEach(function(e){var o=i(e,t.groupField);n[o]||(n[o]=[]),n[o].push(e)});var o=[];return Object.keys(n).forEach(function(t){o.push({group:t,items:n[t]})}),o}return[{items:this.data}]},isEmpty:function(){return!this.computedData||!this.computedData.some(function(t){return t.items&&t.items.length})},whiteList:function(){var t=[];if(t.push(this.$refs.input.$el.querySelector("input")),t.push(this.$refs.dropdown),void 0!==this.$refs.dropdown){var e=this.$refs.dropdown.querySelectorAll("*"),n=!0,i=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var u=r.value;t.push(u)}}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}if(this.$parent.$data._isTaginput){t.push(this.$parent.$el);var l=this.$parent.$el.querySelectorAll("*"),a=!0,c=!1,d=void 0;try{for(var p,h=l[Symbol.iterator]();!(a=(p=h.next()).done);a=!0){var f=p.value;t.push(f)}}catch(t){c=!0,d=t}finally{try{a||null==h.return||h.return()}finally{if(c)throw d}}}return t},hasDefaultSlot:function(){return!!this.$scopedSlots.default},hasGroupSlot:function(){return!!this.$scopedSlots.group},hasEmptySlot:function(){return!!this.$slots.empty}},watch:{newValue:function(t){this.$emit("input",t);var e=this.getValue(this.selected);e&&e!==t&&this.setSelected(null,!1),!this.hasFocus||this.openOnFocus&&!t||(this.isActive=!!t)},value:function(t){this.newValue=t},data:function(){var t=this;this.keepFirst&&this.$nextTick(function(){t.isActive?t.selectFirstOption(t.computedData):t.setHovered(null)})}},methods:{setHovered:function(t){void 0!==t&&(this.hovered=t)},setSelected:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(void 0!==t){if(this.selected=t,this.$emit("select",this.selected,i),null!==this.selected){if(this.clearOnSelect){var o=this.$refs.input;o.newValue="",o.$refs.input.value="",o.$refs.input.focus()}else this.newValue=this.getValue(this.selected);this.setHovered(null)}n&&this.$nextTick(function(){e.isActive=!1})}},selectFirstOption:function(t){var e=this;this.$nextTick(function(){var n=t.filter(function(t){return t.items&&t.items.length});if(n.length){var i=n[0].items[0];e.setHovered(i)}else e.setHovered(null)})},keydown:function(t){var e=t.key;if("Enter"===e&&t.preventDefault(),"Escape"!==e&&"Tab"!==e||(this.isActive=!1),this.confirmKeys.indexOf(e)>=0){","===e&&t.preventDefault();var n=!this.keepOpen||"Tab"===e;if(null===this.hovered)return;this.setSelected(this.hovered,n,t)}},clickedOutside:function(t){var e="shadowRoot"in this.$root.$options?t.composedPath()[0]:t.target;!this.hasFocus&&this.whiteList.indexOf(e)<0&&(this.keepFirst&&this.hovered&&this.selectOnClickOutside?this.setSelected(this.hovered,!0):this.isActive=!1)},getValue:function(t){if(null!==t)return void 0!==this.customFormatter?this.customFormatter(t):"object"===e(t)?i(t,this.field):t},checkIfReachedTheEndOfScroll:function(t){t.clientHeight!==t.scrollHeight&&t.scrollTop+t.clientHeight>=t.scrollHeight&&this.$emit("infinite-scroll")},keyArrows:function(t){var e="down"===t?1:-1;if(this.isActive){var i=this.computedData.map(function(t){return t.items}).reduce(function(t,e){return[].concat(n(t),n(e))},[]),o=i.indexOf(this.hovered)+e;o=(o=o>i.length-1?i.length-1:o)<0?0:o,this.setHovered(void 0!==i[o]?i[o]:null);var r=this.$refs.dropdown.querySelector(".gov-autocomplete__results"),s=r.querySelectorAll(".gov-autocomplete__result")[o];if(!s)return;var u=r.scrollTop,l=r.scrollTop+r.clientHeight-s.clientHeight;s.offsetTop<u?r.scrollTop=s.offsetTop:s.offsetTop>=l&&(r.scrollTop=s.offsetTop-r.clientHeight+s.clientHeight)}else this.isActive=!0},focused:function(t){this.getValue(this.selected)===this.newValue&&this.$el.querySelector("input").select(),this.openOnFocus&&(this.isActive=!0,this.keepFirst&&this.selectFirstOption(this.computedData)),this.hasFocus=!0,this.$emit("focus",t)},onBlur:function(t){this.hasFocus=!1,this.$emit("blur",t)},onInput:function(){var t=this.getValue(this.selected);t&&t===this.newValue||this.$emit("typing",this.newValue)}},created:function(){"undefined"!=typeof window&&document.addEventListener("click",this.clickedOutside)},mounted:function(){var t=this;if(this.checkInfiniteScroll&&this.$refs.dropdown&&this.$refs.dropdown.querySelector(".gov-autocomplete__results")){var e=this.$refs.dropdown.querySelector(".gov-autocomplete__results");e.addEventListener("scroll",function(){return t.checkIfReachedTheEndOfScroll(e)})}},beforeDestroy:function(){("undefined"!=typeof window&&document.removeEventListener("click",this.clickedOutside),this.checkInfiniteScroll&&this.$refs.dropdown&&this.$refs.dropdown.querySelector(".gov-autocomplete__results"))&&this.$refs.dropdown.querySelector(".gov-autocomplete__results").removeEventListener("scroll",this.checkIfReachedTheEndOfScroll)}},void 0,!1,void 0,!1,void 0,void 0,void 0);var h,f={install:function(t){!function(t,e){t.component(e.name,e)}(t,p)}};h=f,"undefined"!=typeof window&&window.Vue&&window.Vue.use(h),t.GovAutocomplete=p,t.default=f,Object.defineProperty(t,"__esModule",{value:!0})});
